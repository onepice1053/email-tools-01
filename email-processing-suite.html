<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Advanced Email Processing Suite</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #5e72e4;
      --primary-dark: #4c63d2;
      --secondary-color: #6c757d;
      --accent-color: #2dce89;
      --info-color: #11cdef;
      --warning-color: #fb6340;
      --danger-color: #f5365c;
      --text-color: #32325d;
      --light-text: #8898aa;
      --bg-color: #f4f5f7;
      --card-bg: #ffffff;
      --sidebar-bg: #1e3a5f;
      --sidebar-text: #f7fafc;
      --sidebar-hover: #2a4a73;
      --border-color: #e9ecef;
      --shadow-sm: 0 0 0.5rem rgba(0, 0, 0, 0.05);
      --shadow-md: 0 0.25rem 0.75rem rgba(0, 0, 0, 0.05);
      --shadow-lg: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.1);
      --shadow-xl: 0 0.75rem 2rem rgba(0, 0, 0, 0.15);
      --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --gradient-success: linear-gradient(135deg, #2dce89 0%, #2dcecc 100%);
      --gradient-info: linear-gradient(135deg, #11cdef 0%, #1171ef 100%);
      --gradient-warning: linear-gradient(135deg, #fb6340 0%, #fbb140 100%);
      --gradient-danger: linear-gradient(135deg, #f5365c 0%, #f56036 100%);
      --gradient-dark: linear-gradient(135deg, #1e3a5f 0%, #2a4a73 100%);
    }

    body.dark-mode {
      --primary-color: #7b92ff;
      --primary-dark: #6a80ff;
      --secondary-color: #8898aa;
      --accent-color: #2dcecc;
      --info-color: #11cdef;
      --warning-color: #fb6340;
      --danger-color: #f5365c;
      --text-color: #f7fafc;
      --light-text: #cbd5e0;
      --bg-color: #1a202c;
      --card-bg: #2d3748;
      --sidebar-bg: #1a202c;
      --sidebar-text: #f7fafc;
      --sidebar-hover: #2d3748;
      --border-color: #4a5568;
      --shadow-sm: 0 0 0.5rem rgba(0, 0, 0, 0.1);
      --shadow-md: 0 0.25rem 0.75rem rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.2);
      --shadow-xl: 0 0.75rem 2rem rgba(0, 0, 0, 0.3);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      line-height: 1.6;
      transition: all 0.3s ease;
      overflow-x: hidden;
    }

    /* Sidebar Styles */
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      width: 280px;
      background: var(--sidebar-bg);
      color: var(--sidebar-text);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 1000;
      box-shadow: var(--shadow-lg);
      overflow-y: auto;
      overflow-x: hidden;
    }

    .sidebar-header {
      padding: 2rem 1.5rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      background: var(--gradient-dark);
    }

    .sidebar-header h2 {
      font-size: 1.5rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .sidebar-header h2 i {
      font-size: 1.75rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
    }

    .nav-menu {
      padding: 1.5rem 0;
    }

    .nav-item {
      margin-bottom: 0.5rem;
    }

    .nav-link {
      display: flex;
      align-items: center;
      padding: 1rem 1.5rem;
      color: var(--sidebar-text);
      text-decoration: none;
      border-radius: 0;
      transition: all 0.3s ease;
      cursor: pointer;
      font-weight: 500;
      position: relative;
      overflow: hidden;
    }

    .nav-link::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 4px;
      background: var(--gradient-primary);
      transform: translateX(-100%);
      transition: transform 0.3s ease;
    }

    .nav-link:hover {
      background: var(--sidebar-hover);
      padding-left: 2rem;
    }

    .nav-link:hover::before {
      transform: translateX(0);
    }

    .nav-link.active {
      background: var(--sidebar-hover);
      color: #fff;
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.1);
    }

    .nav-link.active::before {
      transform: translateX(0);
    }

    .nav-link i {
      margin-right: 1rem;
      font-size: 1.1rem;
      width: 24px;
      text-align: center;
    }

    .tool-button {
      margin: 1.5rem;
      padding: 1rem;
      background: var(--gradient-primary);
      color: white;
      border: none;
      border-radius: 0.75rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      box-shadow: var(--shadow-md);
      position: relative;
      overflow: hidden;
    }

    .tool-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.1);
      transition: left 0.3s ease;
    }

    .tool-button:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .tool-button:hover::before {
      left: 100%;
    }

    /* Main Content */
    .main-content {
      margin-left: 280px;
      padding: 2rem;
      min-height: 100vh;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding: 1.5rem;
      background: var(--card-bg);
      border-radius: 1rem;
      box-shadow: var(--shadow-sm);
    }

    .header h1 {
      font-size: 2rem;
      font-weight: 800;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin: 0;
      letter-spacing: -0.5px;
    }

    .user-profile {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.5rem 1rem;
      background: var(--bg-color);
      border-radius: 2rem;
      box-shadow: var(--shadow-sm);
    }

    .user-profile img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid var(--primary-color);
    }

    /* NEW: Split Layout */
    .split-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      margin-bottom: 2rem;
    }

    @media (max-width: 1200px) {
      .split-container {
        grid-template-columns: 1fr;
      }
    }

    /* Card Styles */
    .card {
      background: var(--card-bg);
      border-radius: 1rem;
      box-shadow: var(--shadow-md);
      padding: 2rem;
      margin-bottom: 2rem;
      transition: all 0.3s ease;
      border: 1px solid var(--border-color);
      position: relative;
      overflow: hidden;
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--gradient-primary);
      transform: scaleX(0);
      transform-origin: left;
      transition: transform 0.3s ease;
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-xl);
    }

    .card:hover::before {
      transform: scaleX(1);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border-color);
    }

    .card-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary-color);
      margin: 0;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .card-title i {
      font-size: 1.5rem;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .card-body {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    /* Form Elements */
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--text-color);
      font-size: 0.875rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    textarea, input[type="file"], input[type="text"] {
      width: 100%;
      padding: 1rem;
      font-size: 1rem;
      border: 2px solid var(--border-color);
      border-radius: 0.75rem;
      transition: all 0.3s ease;
      margin-bottom: 1rem;
      background: var(--card-bg);
      color: var(--text-color);
      font-family: 'Inter', sans-serif;
      box-shadow: var(--shadow-sm);
    }

    textarea:focus, input[type="file"]:focus, input[type="text"]:focus {
      border-color: var(--primary-color);
      outline: none;
      box-shadow: 0 0 0 4px rgba(94, 114, 228, 0.1);
      transform: translateY(-2px);
    }

    textarea {
      min-height: 150px;
      resize: vertical;
      font-family: 'Inter', monospace;
      line-height: 1.5;
    }

    /* File Upload Area */
    .file-upload-area {
      display: flex;
      gap: 1rem;
      align-items: center;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .file-info {
      color: var(--light-text);
      font-size: 0.875rem;
      flex: 1;
      padding: 0.5rem 1rem;
      background: var(--bg-color);
      border-radius: 0.5rem;
      border: 1px solid var(--border-color);
    }

    /* Options */
    .options {
      margin: 1rem 0;
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
    }

    .options label {
      display: inline-flex;
      align-items: center;
      margin-bottom: 0;
      cursor: pointer;
      font-weight: 500;
      background: var(--bg-color);
      padding: 0.75rem 1rem;
      border-radius: 0.5rem;
      transition: all 0.3s ease;
      border: 2px solid var(--border-color);
      font-size: 0.875rem;
      text-transform: none;
      letter-spacing: normal;
    }

    .options label:hover {
      background: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .options input[type="checkbox"] {
      margin-right: 0.5rem;
      width: 18px;
      height: 18px;
      accent-color: var(--primary-color);
      cursor: pointer;
    }

    /* Buttons */
    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      margin-right: 0.75rem;
      margin-bottom: 0.75rem;
      box-shadow: var(--shadow-sm);
      position: relative;
      overflow: hidden;
      font-size: 0.875rem;
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.1);
      transition: left 0.3s ease;
    }

    .btn:hover::before {
      left: 100%;
    }

    .btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
      box-shadow: none !important;
    }

    .btn i {
      font-size: 1rem;
    }

    .btn-primary {
      background: var(--gradient-primary);
      color: white;
    }

    .btn-success {
      background: var(--gradient-success);
      color: white;
    }

    .btn-info {
      background: var(--gradient-info);
      color: white;
    }

    .btn-warning {
      background: var(--gradient-warning);
      color: white;
    }

    .btn-danger {
      background: var(--gradient-danger);
      color: white;
    }

    .btn-secondary {
      background: var(--secondary-color);
      color: white;
    }

    /* Progress Bar */
    .progress {
      margin: 1rem 0;
      height: 8px;
      background: var(--border-color);
      border-radius: 1rem;
      overflow: hidden;
      box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .progress-bar {
      height: 100%;
      background: var(--gradient-primary);
      width: 0;
      transition: width 0.5s ease;
      border-radius: 1rem;
      position: relative;
      overflow: hidden;
    }

    .progress-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    /* Output Area */
    .output {
      flex: 1;
      white-space: pre-wrap;
      background: var(--bg-color);
      padding: 1.5rem;
      border-radius: 0.75rem;
      overflow-y: auto;
      font-family: 'JetBrains Mono', 'Fira Code', monospace;
      font-size: 0.875rem;
      border: 1px solid var(--border-color);
      line-height: 1.6;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.06);
      min-height: 200px;
    }

    /* Summary */
    .summary {
      margin: 1rem 0;
      padding: 1.25rem 1.5rem;
      border-radius: 0.75rem;
      font-size: 0.875rem;
      font-weight: 500;
      border-left: 4px solid var(--primary-color);
      background: var(--bg-color);
      box-shadow: var(--shadow-sm);
      transition: all 0.3s ease;
    }

    .summary.success {
      border-left-color: var(--accent-color);
      background: linear-gradient(135deg, rgba(45, 206, 137, 0.1), rgba(45, 206, 204, 0.1));
    }

    .summary.warning {
      border-left-color: var(--warning-color);
      background: linear-gradient(135deg, rgba(251, 99, 64, 0.1), rgba(251, 177, 64, 0.1));
    }

    .summary.error {
      border-left-color: var(--danger-color);
      background: linear-gradient(135deg, rgba(245, 54, 92, 0.1), rgba(245, 96, 54, 0.1));
    }

    /* Stats Container */
    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin: 1rem 0;
    }

    .stat-card {
      background: var(--card-bg);
      padding: 1.5rem;
      border-radius: 0.75rem;
      box-shadow: var(--shadow-sm);
      text-align: center;
      transition: all 0.3s ease;
      border: 1px solid var(--border-color);
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--gradient-primary);
      transform: scaleX(0);
      transform-origin: left;
      transition: transform 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .stat-card:hover::before {
      transform: scaleX(1);
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 800;
      color: var(--primary-color);
      margin-bottom: 0.5rem;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .stat-label {
      font-size: 0.75rem;
      color: var(--light-text);
      text-transform: uppercase;
      letter-spacing: 1px;
      font-weight: 600;
    }

    /* Tab Content */
    .tab-content {
      display: none;
      animation: fadeInUp 0.5s ease;
    }

    .tab-content.active {
      display: block;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Mobile Menu Button */
    .mobile-menu-btn {
      display: none;
      position: fixed;
      top: 1rem;
      left: 1rem;
      z-index: 1001;
      background: var(--gradient-primary);
      color: white;
      border: none;
      border-radius: 0.5rem;
      width: 48px;
      height: 48px;
      font-size: 1.25rem;
      cursor: pointer;
      box-shadow: var(--shadow-lg);
      transition: all 0.3s ease;
    }

    .mobile-menu-btn:hover {
      transform: scale(1.05);
      box-shadow: var(--shadow-xl);
    }

    /* Spinner */
    .spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Alert */
    .alert {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      padding: 1rem 1.5rem;
      border-radius: 0.75rem;
      box-shadow: var(--shadow-xl);
      z-index: 9999;
      max-width: 350px;
      animation: slideInRight 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .alert-success {
      background: var(--gradient-success);
      color: white;
    }

    .alert-warning {
      background: var(--gradient-warning);
      color: white;
    }

    .alert-error {
      background: var(--gradient-danger);
      color: white;
    }

    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
      }
      
      .sidebar.active {
        transform: translateX(0);
      }
      
      .main-content {
        margin-left: 0;
        padding: 1rem;
      }
      
      .mobile-menu-btn {
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
        padding: 1rem;
      }
      
      .user-profile {
        align-self: flex-end;
      }
      
      .options {
        flex-direction: column;
        gap: 0.75rem;
      }
      
      .options label {
        width: 100%;
        margin-right: 0;
      }
      
      .stats-container {
        grid-template-columns: 1fr;
      }
      
      .card {
        padding: 1.5rem;
      }
      
      .card-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
      }
      
      .file-upload-area {
        flex-direction: column;
        align-items: stretch;
      }
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-color);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--primary-color);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--primary-dark);
    }
  </style>
</head>
<body>
  <button class="mobile-menu-btn" id="mobileMenuBtn">
    <i class="fas fa-bars"></i>
  </button>

  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h2><i class="fas fa-envelope-open-text"></i> Email Suite</h2>
    </div>
    <nav class="nav-menu">
      <div class="nav-item">
        <div class="nav-link active" data-tab="filter">
          <i class="fas fa-filter"></i> Email Filter
        </div>
      </div>
      <div class="nav-item">
        <div class="nav-link" data-tab="dedupe">
          <i class="fas fa-clone"></i> Deduplicate
        </div>
      </div>
      <div class="nav-item">
        <div class="nav-link" data-tab="domainExtract">
          <i class="fas fa-globe"></i> Domain Extract
        </div>
      </div>
    </nav>
    
    <button class="tool-button" onclick="toggleDarkMode()">
      <i class="fas fa-moon"></i> Toggle Dark Mode
    </button>
  </div>

  <div class="main-content">
    <div class="header">
      <h1>Advanced Email Processing Suite</h1>
      <div class="user-profile">
        <img src="https://ui-avatars.com/api/?name=User+Name&background=5e72e4&color=fff" alt="User">
        <span>Welcome, User</span>
      </div>
    </div>

    <div id="filter-tab" class="tab-content active">
      <div class="split-container">
        <!-- Left Side: Input -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title"><i class="fas fa-upload"></i> Input</h3>
          </div>
          <div class="card-body">
            <label>Upload File:</label>
            <div class="file-upload-area">
              <button class="btn btn-secondary" onclick="document.getElementById('fileInput').click()">
                <i class="fas fa-upload"></i> Upload File
              </button>
              <input type="file" id="fileInput" accept=".txt,.csv" style="display: none;" />
              <div class="file-info">
                <span id="filterFileName">No file selected</span>
              </div>
            </div>
            
            <label>Paste Emails Here:</label>
            <textarea id="filterInput" placeholder="Paste email addresses here (one per line)&#10;example1@gmail.com&#10;example2@yahoo.com&#10;example3@hotmail.com&#10;ralf.schill@online.de:Ralf1962"></textarea>
            
            <label>Filter Keywords/Domains:</label>
            <textarea id="keywords" placeholder="Enter keywords or domains to filter by (one per line), e.g.:&#10;@gmail.com&#10;@yahoo.com&#10;important-domain.com"></textarea>

            <div class="options">
              <label><input type="checkbox" id="reverse"> Reverse Filter (exclude matches)</label>
              <label><input type="checkbox" id="caseSensitive"> Case Sensitive</label>
              <label><input type="checkbox" id="useRegex"> Use Regular Expressions</label>
              <label><input type="checkbox" id="validateEmails"> Validate Emails</label>
              <label><input type="checkbox" id="extractEmailsOnly"> Extract Emails Only</label>
            </div>

            <div>
              <button class="btn btn-success" id="filterBtn" onclick="processFilter()">
                <i class="fas fa-filter"></i> Filter Emails
              </button>
              <button class="btn btn-secondary" onclick="clearFilter()">
                <i class="fas fa-times"></i> Clear Input
              </button>
            </div>

            <div class="progress">
              <div class="progress-bar" id="progressBar"></div>
            </div>
            
            <div class="summary" id="summary">Ready to process your email list.</div>
          </div>
        </div>

        <!-- Right Side: Results -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title"><i class="fas fa-chart-bar"></i> Results</h3>
          </div>
          <div class="card-body">
            <div class="stats-container" id="filterStats" style="display: none;">
              <div class="stat-card">
                <div class="stat-value" id="processedCount">0</div>
                <div class="stat-label">Processed</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="filteredCount">0</div>
                <div class="stat-label">Filtered</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="removedCount">0</div>
                <div class="stat-label">Removed</div>
              </div>
            </div>
            
            <div style="margin-bottom: 1rem;">
              <button class="btn btn-primary" onclick="downloadFile()">
                <i class="fas fa-download"></i> Download Results
              </button>
              <button class="btn btn-info" onclick="copyResults()">
                <i class="fas fa-copy"></i> Copy Results
              </button>
            </div>
            
            <label>Filtered Results:</label>
            <div class="output" id="output"></div>
          </div>
        </div>
      </div>
    </div>

    <div id="dedupe-tab" class="tab-content">
      <div class="split-container">
        <!-- Left Side: Input -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title"><i class="fas fa-upload"></i> Input</h3>
          </div>
          <div class="card-body">
            <div style="margin-bottom: 1rem; color: var(--light-text);">
              Upload a file or paste email addresses below to remove duplicates. The tool will keep only unique email addresses.
            </div>
            
            <label>Upload File:</label>
            <div class="file-upload-area">
              <button class="btn btn-secondary" onclick="document.getElementById('duplicateFileInput').click()">
                <i class="fas fa-upload"></i> Upload File
              </button>
              <input type="file" id="duplicateFileInput" accept=".txt,.csv" style="display: none;" />
              <div class="file-info">
                <span id="dedupeFileName">No file selected</span>
              </div>
            </div>
            
            <label>Paste Emails Here:</label>
            <textarea id="duplicateInput" placeholder="Paste email addresses here (one per line)&#10;example1@gmail.com&#10;example2@yahoo.com&#10;example3@hotmail.com&#10;ralf.schill@online.de:Ralf1962"></textarea>

            <div class="options">
              <label><input type="checkbox" id="dedupeValidateEmails"> Validate Emails</label>
              <label><input type="checkbox" id="dedupePreserveCase"> Preserve Original Case</label>
              <label><input type="checkbox" id="dedupeExtractEmailsOnly"> Extract Emails Only</label>
            </div>

            <div>
              <button class="btn btn-success" id="dedupeBtn" onclick="removeDuplicates()">
                <i class="fas fa-redo"></i> Remove Duplicates
              </button>
              <button class="btn btn-secondary" onclick="clearDedupe()">
                <i class="fas fa-times"></i> Clear Input
              </button>
            </div>
            
            <div class="summary" id="dedupeSummary">Ready to deduplicate your email list.</div>
          </div>
        </div>

        <!-- Right Side: Results -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title"><i class="fas fa-chart-bar"></i> Results</h3>
          </div>
          <div class="card-body">
            <div class="stats-container" id="dedupeStats" style="display: none;">
              <div class="stat-card">
                <div class="stat-value" id="originalCount">0</div>
                <div class="stat-label">Original</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="uniqueCount">0</div>
                <div class="stat-label">Unique</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="duplicatesCount">0</div>
                <div class="stat-label">Duplicates</div>
              </div>
            </div>
            
            <div style="margin-bottom: 1rem;">
              <button class="btn btn-info" onclick="copyDedupeResults()">
                <i class="fas fa-copy"></i> Copy Clean List
              </button>
              <button class="btn btn-primary" onclick="downloadDedupeResults()">
                <i class="fas fa-download"></i> Download Clean List
              </button>
            </div>
            
            <label>Deduplicated Results:</label>
            <div class="output" id="dedupeOutput"></div>
          </div>
        </div>
      </div>
    </div>

    <div id="domainExtract-tab" class="tab-content">
      <div class="split-container">
        <!-- Left Side: Input -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title"><i class="fas fa-upload"></i> Input</h3>
          </div>
          <div class="card-body">
            <div style="margin-bottom: 1rem; color: var(--light-text);">
              Upload a file or paste email addresses below, then specify domains to extract emails from.
            </div>
            
            <label>Upload File:</label>
            <div class="file-upload-area">
              <button class="btn btn-secondary" onclick="document.getElementById('domainFileInput').click()">
                <i class="fas fa-upload"></i> Upload File
              </button>
              <input type="file" id="domainFileInput" accept=".txt,.csv" style="display: none;" />
              <div class="file-info">
                <span id="domainFileName">No file selected</span>
              </div>
            </div>
            
            <label>Paste Emails Here:</label>
            <textarea id="domainInput" placeholder="Paste email addresses here (one per line)&#10;example1@gmail.com&#10;example2@yahoo.com&#10;example3@hotmail.com&#10;ralf.schill@online.de:Ralf1962"></textarea>
            
            <label>Domains to Extract:</label>
            <textarea id="domainsList" placeholder="Enter domains to extract (one per line), e.g.:&#10;@gmail.com&#10;@yahoo.com&#10;@example.com&#10;example.uk"></textarea>
            
            <div class="options">
              <label><input type="checkbox" id="domainValidateEmails"> Validate Emails</label>
              <label><input type="checkbox" id="domainCaseSensitive"> Case Sensitive</label>
            </div>

            <div>
              <button class="btn btn-success" id="domainExtractBtn" onclick="extractByDomain()">
                <i class="fas fa-search"></i> Extract Emails
              </button>
              <button class="btn btn-secondary" onclick="clearDomainExtract()">
                <i class="fas fa-times"></i> Clear Input
              </button>
            </div>
            
            <div class="summary" id="domainSummary">Ready to extract emails by domain.</div>
          </div>
        </div>

        <!-- Right Side: Results -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title"><i class="fas fa-chart-bar"></i> Results</h3>
          </div>
          <div class="card-body">
            <div class="stats-container" id="domainStats" style="display: none;">
              <div class="stat-card">
                <div class="stat-value" id="domainProcessedCount">0</div>
                <div class="stat-label">Processed</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="domainExtractedCount">0</div>
                <div class="stat-label">Extracted</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="domainDomainsCount">0</div>
                <div class="stat-label">Domains</div>
              </div>
            </div>
            
            <div style="margin-bottom: 1rem;">
              <button class="btn btn-info" onclick="copyDomainResults()">
                <i class="fas fa-copy"></i> Copy Results
              </button>
              <button class="btn btn-primary" onclick="downloadDomainResults()">
                <i class="fas fa-download"></i> Download Results
              </button>
            </div>
            
            <label>Extracted Results:</label>
            <div class="output" id="domainOutput"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // JavaScript code remains exactly the same as before
    let filteredLines = [];
    let deduplicatedEmails = [];
    let domainExtractedEmails = [];
    const emailRegex = /^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;
    const CHUNK_SIZE = 10000;

    document.addEventListener('DOMContentLoaded', function() {
      const mobileMenuBtn = document.getElementById('mobileMenuBtn');
      const sidebar = document.getElementById('sidebar');
      
      mobileMenuBtn.addEventListener('click', function() {
        sidebar.classList.toggle('active');
      });

      window.addEventListener('resize', function() {
        if (window.innerWidth > 768) {
          sidebar.classList.remove('active');
        }
      });

      document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', function() {
          const tabName = this.dataset.tab;
          switchTab(tabName);
        });
      });

      const fileInput = document.getElementById('fileInput');
      const duplicateFileInput = document.getElementById('duplicateFileInput');
      const domainFileInput = document.getElementById('domainFileInput');
      
      fileInput.addEventListener('change', function() {
        const fileName = this.files[0] ? this.files[0].name : 'No file selected';
        document.getElementById('filterFileName').textContent = fileName;
      });
      
      duplicateFileInput.addEventListener('change', function() {
        const fileName = this.files[0] ? this.files[0].name : 'No file selected';
        document.getElementById('dedupeFileName').textContent = fileName;
      });
      
      domainFileInput.addEventListener('change', function() {
        const fileName = this.files[0] ? this.files[0].name : 'No file selected';
        document.getElementById('domainFileName').textContent = fileName;
      });

      if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
      }
    });

    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      const isDark = document.body.classList.contains('dark-mode');
      localStorage.setItem('darkMode', isDark);
    }

    function switchTab(tabName) {
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
      });
      
      document.getElementById(`${tabName}-tab`).classList.add('active');
      document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
      
      if (window.innerWidth <= 768) {
        document.getElementById('sidebar').classList.remove('active');
      }
    }

    // Function to extract email from text that might contain additional info after colon
    function extractEmail(text) {
      if (!text) return '';
      
      // Check if text contains a colon and extract only the email part
      if (text.includes(':')) {
        const parts = text.split(':');
        // Return the first part which should be the email
        return parts[0].trim();
      }
      
      return text.trim();
    }

    // Domain Extraction Functions
    async function extractByDomain() {
      const fileInput = document.getElementById('domainFileInput');
      const textInput = document.getElementById('domainInput');
      const domainsText = document.getElementById('domainsList').value;
      const validate = document.getElementById('domainValidateEmails').checked;
      const caseSensitive = document.getElementById('domainCaseSensitive').checked;
      const output = document.getElementById('domainOutput');
      const summary = document.getElementById('domainSummary');
      const extractBtn = document.getElementById('domainExtractBtn');
      
      // Parse domains from textarea
      const domains = domainsText.split(/\r?\n/).map(d => d.trim()).filter(d => d);
      
      if (domains.length === 0) {
        showAlert('Please enter at least one domain to extract.', 'warning');
        return;
      }
      
      // Format domains (ensure they start with @)
      const formattedDomains = domains.map(domain => {
        if (!domain.startsWith('@')) {
          return '@' + domain;
        }
        return domain;
      });
      
      let emails = [];
      
      extractBtn.disabled = true;
      extractBtn.innerHTML = '<span class="spinner"></span> Processing...';
      
      try {
        if (fileInput.files[0]) {
          const file = fileInput.files[0];
          summary.textContent = `Processing file: ${file.name} (${formatBytes(file.size)})...`;
          summary.className = 'summary warning';
          
          const text = await file.text();
          emails = text.split(/\r?\n/).map(e => e.trim()).filter(e => e);
        } else if (textInput.value.trim()) {
          emails = textInput.value.split(/\r?\n/).map(e => e.trim()).filter(e => e);
          summary.textContent = 'Processing pasted text...';
          summary.className = 'summary warning';
        } else {
          showAlert('Please upload a file or paste email addresses first.', 'warning');
          extractBtn.disabled = false;
          extractBtn.innerHTML = '<i class="fas fa-search"></i> Extract Emails';
          return;
        }
        
        if (emails.length === 0) {
          showAlert('No emails found to process.', 'warning');
          extractBtn.disabled = false;
          extractBtn.innerHTML = '<i class="fas fa-search"></i> Extract Emails';
          return;
        }
        
        await new Promise(resolve => setTimeout(resolve, 0));
        
        // Extract emails only (always enabled for Domain Extract)
        emails = emails.map(email => extractEmail(email));
        
        let processedEmails = emails;
        let invalidCount = 0;
        
        if (validate) {
          processedEmails = processedEmails.filter(email => {
            const isValid = emailRegex.test(email);
            if (!isValid) invalidCount++;
            return isValid;
          });
        }
        
        // Extract emails by domains
        domainExtractedEmails = processedEmails.filter(email => {
          const emailToTest = caseSensitive ? email : email.toLowerCase();
          return formattedDomains.some(domain => {
            const domainToTest = caseSensitive ? domain : domain.toLowerCase();
            return emailToTest.includes(domainToTest);
          });
        });
        
        output.textContent = domainExtractedEmails.slice(0, 200).join('\n') + 
          (domainExtractedEmails.length > 200 ? `\n\n... and ${domainExtractedEmails.length - 200} more emails (use Download to get all results)` : '');
        
        const extractedCount = domainExtractedEmails.length;
        let summaryText = `Processed: ${processedEmails.length.toLocaleString()} | Extracted: ${extractedCount.toLocaleString()} | Domains: ${formattedDomains.length}`;
        
        if (validate && invalidCount > 0) {
          summaryText += ` | Invalid: ${invalidCount.toLocaleString()}`;
        }
        
        summaryText += ' | Emails extracted only';
        
        summary.textContent = summaryText;
        summary.className = 'summary success';
        
        // Update stats
        document.getElementById('domainStats').style.display = 'grid';
        document.getElementById('domainProcessedCount').textContent = processedEmails.length.toLocaleString();
        document.getElementById('domainExtractedCount').textContent = extractedCount.toLocaleString();
        document.getElementById('domainDomainsCount').textContent = formattedDomains.length;
        
        if (extractedCount === 0) {
          summary.textContent += ' (No matching emails found)';
        }
        
        showAlert('Domain extraction completed successfully!', 'success');
      } catch (error) {
        summary.textContent = `Error: ${error.message}`;
        summary.className = 'summary error';
        console.error(error);
        showAlert('An error occurred during processing.', 'error');
      } finally {
        extractBtn.disabled = false;
        extractBtn.innerHTML = '<i class="fas fa-search"></i> Extract Emails';
      }
    }

    function copyDomainResults() {
      if (!domainExtractedEmails || domainExtractedEmails.length === 0) {
        showAlert('No results to copy. Please extract emails by domain first.', 'warning');
        return;
      }
      navigator.clipboard.writeText(domainExtractedEmails.join('\n'))
        .then(() => showAlert(`${domainExtractedEmails.length.toLocaleString()} emails copied to clipboard!`, 'success'))
        .catch(() => showAlert('Failed to copy results to clipboard.', 'error'));
    }

    function downloadDomainResults() {
      if (!domainExtractedEmails || domainExtractedEmails.length === 0) {
        showAlert('No results to download. Please extract emails by domain first.', 'warning');
        return;
      }
      try {
        const blob = new Blob([domainExtractedEmails.join('\n')], { type: 'text/plain' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `domain_extracted_emails_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.txt`;
        a.click();
        URL.revokeObjectURL(a.href);
        showAlert('Download started successfully!', 'success');
      } catch (error) {
        showAlert('Failed to create download file.', 'error');
        console.error(error);
      }
    }

    function clearDomainExtract() {
      document.getElementById('domainFileInput').value = '';
      document.getElementById('domainInput').value = '';
      document.getElementById('domainsList').value = '';
      document.getElementById('domainOutput').textContent = '';
      document.getElementById('domainSummary').textContent = 'Ready to extract emails by domain.';
      document.getElementById('domainSummary').className = 'summary';
      document.getElementById('domainFileName').textContent = 'No file selected';
      document.getElementById('domainStats').style.display = 'none';
      domainExtractedEmails = [];
      
      showAlert('Domain extraction cleared successfully!', 'success');
    }

    // Existing Functions (Filter and Dedupe)
    async function processFilter() {
      const fileInput = document.getElementById('fileInput');
      const textInput = document.getElementById('filterInput');
      const keywordsText = document.getElementById('keywords').value;
      const reverse = document.getElementById('reverse').checked;
      const caseSensitive = document.getElementById('caseSensitive').checked;
      const useRegex = document.getElementById('useRegex').checked;
      const validate = document.getElementById('validateEmails').checked;
      const extractEmailsOnly = document.getElementById('extractEmailsOnly').checked;
      const progressBar = document.getElementById('progressBar');
      const output = document.getElementById('output');
      const summary = document.getElementById('summary');
      const filterBtn = document.getElementById('filterBtn');

      const keywords = keywordsText.split(/\r?\n/).map(k => k.trim()).filter(k => k);

      if (keywords.length === 0) {
        showAlert('Please enter at least one keyword or domain to filter by.', 'warning');
        return;
      }

      filterBtn.disabled = true;
      filterBtn.innerHTML = '<span class="spinner"></span> Processing...';
      
      let lines = [];
      progressBar.style.width = '0%';

      try {
        if (fileInput.files[0]) {
          const file = fileInput.files[0];
          summary.textContent = `Processing file: ${file.name} (${formatBytes(file.size)})...`;
          summary.className = 'summary warning';

          const text = await file.text();
          lines = text.split(/\r?\n/).map(l => l.trim()).filter(l => l);
          progressBar.style.width = '50%';
        } else if (textInput.value.trim()) {
          lines = textInput.value.split(/\r?\n/).map(l => l.trim()).filter(l => l);
          summary.textContent = 'Processing pasted text...';
          summary.className = 'summary warning';
          progressBar.style.width = '50%';
        } else {
          showAlert('Please upload a file or paste text first.', 'warning');
          filterBtn.disabled = false;
          filterBtn.innerHTML = '<i class="fas fa-filter"></i> Filter Emails';
          return;
        }

        if (lines.length === 0) {
          showAlert('No data found to process.', 'warning');
          filterBtn.disabled = false;
          filterBtn.innerHTML = '<i class="fas fa-filter"></i> Filter Emails';
          return;
        }

        // Extract emails only if option is checked
        if (extractEmailsOnly) {
          lines = lines.map(line => extractEmail(line));
        }

        let regexPatterns = [];
        if (useRegex) {
          regexPatterns = keywords.map(k => {
            try {
              return new RegExp(k, caseSensitive ? '' : 'i');
            } catch {
              return null;
            }
          }).filter(r => r !== null);
          
          if (regexPatterns.length === 0) {
            showAlert('No valid regex patterns found.', 'warning');
            filterBtn.disabled = false;
            filterBtn.innerHTML = '<i class="fas fa-filter"></i> Filter Emails';
            return;
          }
        }

        filteredLines = [];
        const totalLines = lines.length;
        let processed = 0;

        for (let i = 0; i < lines.length; i += CHUNK_SIZE) {
          const chunk = lines.slice(i, i + CHUNK_SIZE);
          
          await new Promise(resolve => setTimeout(resolve, 0));
          
          const chunkFiltered = chunk.filter(line => {
            if (validate && !emailRegex.test(line)) return false;
            
            const lineToTest = caseSensitive ? line : line.toLowerCase();
            let matches = false;
            
            if (useRegex) {
              matches = regexPatterns.some(regex => regex.test(line));
            } else {
              matches = keywords.some(keyword => {
                const keywordToTest = caseSensitive ? keyword : keyword.toLowerCase();
                return lineToTest.includes(keywordToTest);
              });
            }
            
            return reverse ? !matches : matches;
          });
          
          filteredLines.push(...chunkFiltered);
          processed += chunk.length;
          progressBar.style.width = `${50 + (processed / totalLines * 50)}%`;
        }

        output.textContent = filteredLines.slice(0, 200).join('\n') + 
          (filteredLines.length > 200 ? `\n\n... and ${filteredLines.length - 200} more lines (use Download to get all results)` : '');

        let summaryText = `Processed ${totalLines.toLocaleString()} lines. Found ${filteredLines.length.toLocaleString()} matching ${reverse ? '(excluded)' : ''} results.`;
        
        if (extractEmailsOnly) {
          summaryText += ' Emails extracted only.';
        }
        
        summary.textContent = summaryText;
        summary.className = 'summary success';
        
        // Update stats
        document.getElementById('filterStats').style.display = 'grid';
        document.getElementById('processedCount').textContent = totalLines.toLocaleString();
        document.getElementById('filteredCount').textContent = filteredLines.length.toLocaleString();
        document.getElementById('removedCount').textContent = (totalLines - filteredLines.length).toLocaleString();
        
        if (filteredLines.length === 0) {
          summary.textContent = `Processed ${totalLines.toLocaleString()} lines. No matching lines found.`;
          summary.className = 'summary warning';
          output.textContent = '';
        }

        progressBar.style.width = '100%';
        showAlert('Filtering completed successfully!', 'success');
      } catch (error) {
        summary.textContent = `Error: ${error.message}`;
        summary.className = 'summary error';
        console.error(error);
        showAlert('An error occurred during processing.', 'error');
      } finally {
        filterBtn.disabled = false;
        filterBtn.innerHTML = '<i class="fas fa-filter"></i> Filter Emails';
      }
    }

    function downloadFile() {
      if (filteredLines.length === 0) {
        showAlert('No results to download. Please filter your data first.', 'warning');
        return;
      }
      try {
        const blob = new Blob([filteredLines.join('\n')], { type: 'text/plain' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `filtered_results_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.txt`;
        a.click();
        URL.revokeObjectURL(a.href);
        showAlert('Download started successfully!', 'success');
      } catch (error) {
        showAlert('Failed to create download file.', 'error');
        console.error(error);
      }
    }

    function copyResults() {
      if (filteredLines.length === 0) {
        showAlert('No results to copy. Please filter your data first.', 'warning');
        return;
      }
      navigator.clipboard.writeText(filteredLines.join('\n'))
        .then(() => showAlert(`${filteredLines.length.toLocaleString()} results copied to clipboard!`, 'success'))
        .catch(() => showAlert('Failed to copy results to clipboard.', 'error'));
    }

    function clearFilter() {
      document.getElementById('fileInput').value = '';
      document.getElementById('filterInput').value = '';
      document.getElementById('keywords').value = '';
      document.getElementById('output').textContent = '';
      document.getElementById('summary').textContent = 'Ready to process your email list.';
      document.getElementById('summary').className = 'summary';
      document.getElementById('progressBar').style.width = '0%';
      document.getElementById('filterFileName').textContent = 'No file selected';
      document.getElementById('filterStats').style.display = 'none';
      filteredLines = [];
      
      showAlert('Filter cleared successfully!', 'success');
    }

    async function removeDuplicates() {
      const fileInput = document.getElementById('duplicateFileInput');
      const textInput = document.getElementById('duplicateInput');
      const validate = document.getElementById('dedupeValidateEmails').checked;
      const preserveCase = document.getElementById('dedupePreserveCase').checked;
      const extractEmailsOnly = document.getElementById('dedupeExtractEmailsOnly').checked;
      const output = document.getElementById('dedupeOutput');
      const summary = document.getElementById('dedupeSummary');
      const dedupeBtn = document.getElementById('dedupeBtn');
      
      let emails = [];
      
      dedupeBtn.disabled = true;
      dedupeBtn.innerHTML = '<span class="spinner"></span> Processing...';
      
      try {
        if (fileInput.files[0]) {
          const file = fileInput.files[0];
          summary.textContent = `Processing file: ${file.name} (${formatBytes(file.size)})...`;
          summary.className = 'summary warning';
          
          const text = await file.text();
          emails = text.split(/\r?\n/).map(e => e.trim()).filter(e => e);
        } else if (textInput.value.trim()) {
          emails = textInput.value.split(/\r?\n/).map(e => e.trim()).filter(e => e);
          summary.textContent = 'Processing pasted text...';
          summary.className = 'summary warning';
        } else {
          showAlert('Please upload a file or paste email addresses first.', 'warning');
          dedupeBtn.disabled = false;
          dedupeBtn.innerHTML = '<i class="fas fa-redo"></i> Remove Duplicates';
          return;
        }
        
        if (emails.length === 0) {
          showAlert('No emails found to process.', 'warning');
          dedupeBtn.disabled = false;
          dedupeBtn.innerHTML = '<i class="fas fa-redo"></i> Remove Duplicates';
          return;
        }
        
        await new Promise(resolve => setTimeout(resolve, 0));
        
        // Extract emails only if option is checked
        if (extractEmailsOnly) {
          emails = emails.map(email => extractEmail(email));
        }
        
        let processedEmails = emails;
        let invalidCount = 0;
        
        if (validate) {
          processedEmails = processedEmails.filter(email => {
            const isValid = emailRegex.test(email);
            if (!isValid) invalidCount++;
            return isValid;
          });
        }
        
        const emailMap = new Map();
        
        processedEmails.forEach(email => {
          const key = preserveCase ? email : email.toLowerCase();
          if (!emailMap.has(key)) {
            emailMap.set(key, preserveCase ? email : email.toLowerCase());
          }
        });
        
        deduplicatedEmails = Array.from(emailMap.values());
        
        output.textContent = deduplicatedEmails.slice(0, 200).join('\n') + 
          (deduplicatedEmails.length > 200 ? `\n\n... and ${deduplicatedEmails.length - 200} more emails (use Download to get all results)` : '');
        
        const duplicatesRemoved = emails.length - deduplicatedEmails.length;
        let summaryText = `Original: ${emails.toLocaleString()} | Unique: ${deduplicatedEmails.length.toLocaleString()} | Duplicates Removed: ${duplicatesRemoved.toLocaleString()}`;
        
        if (validate && invalidCount > 0) {
          summaryText += ` | Invalid: ${invalidCount.toLocaleString()}`;
        }
        
        if (extractEmailsOnly) {
          summaryText += ' | Emails extracted only';
        }
        
        summary.textContent = summaryText;
        summary.className = 'summary success';
        
        // Update stats
        document.getElementById('dedupeStats').style.display = 'grid';
        document.getElementById('originalCount').textContent = emails.length.toLocaleString();
        document.getElementById('uniqueCount').textContent = deduplicatedEmails.length.toLocaleString();
        document.getElementById('duplicatesCount').textContent = duplicatesRemoved.toLocaleString();
        
        if (duplicatesRemoved === 0) {
          summary.textContent += ' (No duplicates found)';
        }
        
        showAlert('Deduplication completed successfully!', 'success');
      } catch (error) {
        summary.textContent = `Error: ${error.message}`;
        summary.className = 'summary error';
        console.error(error);
        showAlert('An error occurred during processing.', 'error');
      } finally {
        dedupeBtn.disabled = false;
        dedupeBtn.innerHTML = '<i class="fas fa-redo"></i> Remove Duplicates';
      }
    }

    function copyDedupeResults() {
      if (!deduplicatedEmails || deduplicatedEmails.length === 0) {
        showAlert('No results to copy. Please remove duplicates first.', 'warning');
        return;
      }
      navigator.clipboard.writeText(deduplicatedEmails.join('\n'))
        .then(() => showAlert(`${deduplicatedEmails.length.toLocaleString()} unique emails copied to clipboard!`, 'success'))
        .catch(() => showAlert('Failed to copy results to clipboard.', 'error'));
    }

    function downloadDedupeResults() {
      if (!deduplicatedEmails || deduplicatedEmails.length === 0) {
        showAlert('No results to download. Please remove duplicates first.', 'warning');
        return;
      }
      try {
        const blob = new Blob([deduplicatedEmails.join('\n')], { type: 'text/plain' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `deduplicated_emails_${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.txt`;
        a.click();
        URL.revokeObjectURL(a.href);
        showAlert('Download started successfully!', 'success');
      } catch (error) {
        showAlert('Failed to create download file.', 'error');
        console.error(error);
      }
    }

    function clearDedupe() {
      document.getElementById('duplicateFileInput').value = '';
      document.getElementById('duplicateInput').value = '';
      document.getElementById('dedupeOutput').textContent = '';
      document.getElementById('dedupeSummary').textContent = 'Ready to deduplicate your email list.';
      document.getElementById('dedupeSummary').className = 'summary';
      document.getElementById('dedupeFileName').textContent = 'No file selected';
      document.getElementById('dedupeStats').style.display = 'none';
      deduplicatedEmails = [];
      
      showAlert('Dedupe cleared successfully!', 'success');
    }

    function formatBytes(bytes, decimals = 2) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const dm = decimals < 0 ? 0 : decimals;
      const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
    }

    function showAlert(message, type = 'success') {
      const alertDiv = document.createElement('div');
      alertDiv.className = `alert alert-${type}`;
      alertDiv.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'times-circle'}"></i> ${message}`;
      alertDiv.style.position = 'fixed';
      alertDiv.style.bottom = '2rem';
      alertDiv.style.right = '2rem';
      alertDiv.style.zIndex = '9999';
      alertDiv.style.maxWidth = '350px';
      
      document.body.appendChild(alertDiv);
      
      setTimeout(() => {
        alertDiv.style.opacity = '0';
        alertDiv.style.transition = 'opacity 0.5s ease';
        setTimeout(() => alertDiv.remove(), 500);
      }, 3000);
    }
  </script>
</body>
</html>
