<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Security Scanner</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4f46e5;
            --primary-light: #818cf8;
            --secondary: #7c3aed;
            --secondary-light: #a78bfa;
            --success: #10b981;
            --success-light: #34d399;
            --warning: #f59e0b;
            --warning-light: #fbbf24;
            --danger: #ef4444;
            --danger-light: #f87171;
            --info: #06b6d4;
            --info-light: #22d3ee;
            --light: #f8fafc;
            --dark: #1e293b;
            --gray: #64748b;
            --gray-light: #94a3b8;
            --bg: #0f172a;
            --card-bg: #1e293b;
            --border: #334155;
            --border-light: #475569;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --shadow-xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            --radius: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            color: #e2e8f0;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }
        
        /* Animated background elements */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 50%, rgba(79, 70, 229, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(124, 58, 237, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 40% 20%, rgba(16, 185, 129, 0.1) 0%, transparent 50%);
            z-index: -1;
            animation: backgroundShift 20s ease-in-out infinite alternate;
        }
        
        @keyframes backgroundShift {
            0% { transform: translate(0, 0) scale(1); }
            100% { transform: translate(-20px, -20px) scale(1.1); }
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(30, 41, 59, 0.85);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            animation: rotate 30s linear infinite;
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        h1 {
            font-size: 40px;
            margin-bottom: 12px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            position: relative;
            z-index: 1;
            letter-spacing: -0.5px;
        }
        
        .tagline {
            font-size: 18px;
            opacity: 0.95;
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 380px 1fr;
            gap: 0;
            min-height: 700px;
        }
        
        .control-panel {
            background: rgba(15, 23, 42, 0.6);
            padding: 30px;
            border-right: 1px solid var(--border);
            overflow-y: auto;
            max-height: calc(100vh - 200px);
            position: relative;
        }
        
        .control-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.8) 0%, rgba(30, 41, 59, 0.4) 100%);
            z-index: -1;
        }
        
        .panel-section {
            margin-bottom: 30px;
            position: relative;
            z-index: 1;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 18px;
            color: var(--primary-light);
            display: flex;
            align-items: center;
            gap: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
        }
        
        .section-title::after {
            content: '';
            flex: 1;
            height: 1px;
            background: linear-gradient(90deg, var(--primary-light) 0%, transparent 100%);
            margin-left: 12px;
        }
        
        .file-upload-area {
            border: 2px dashed rgba(129, 140, 248, 0.5);
            border-radius: var(--radius);
            padding: 24px;
            text-align: center;
            background: rgba(79, 70, 229, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 18px;
            position: relative;
            overflow: hidden;
        }
        
        .file-upload-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(79, 70, 229, 0.1) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .file-upload-area:hover {
            background: rgba(79, 70, 229, 0.1);
            border-color: var(--primary-light);
            transform: translateY(-2px);
        }
        
        .file-upload-area:hover::before {
            opacity: 1;
        }
        
        .file-upload-area i {
            font-size: 36px;
            color: var(--primary-light);
            margin-bottom: 12px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }
        
        input[type="file"] {
            display: none;
        }
        
        .domains-input {
            width: 100%;
            min-height: 120px;
            padding: 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            resize: vertical;
            font-size: 15px;
            background: rgba(15, 23, 42, 0.6);
            color: #e2e8f0;
            transition: all 0.3s ease;
            font-family: 'Inter', monospace;
        }
        
        .domains-input:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
            background: rgba(15, 23, 42, 0.8);
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        
        .setting-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            font-size: 14px;
            color: #cbd5e1;
        }
        
        .setting-group input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: rgba(15, 23, 42, 0.6);
            color: #e2e8f0;
            transition: all 0.3s ease;
            font-size: 15px;
        }
        
        .setting-group input:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
            background: rgba(15, 23, 42, 0.8);
        }
        
        .buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
        }
        
        button {
            padding: 14px 20px;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 15px;
            position: relative;
            overflow: hidden;
        }
        
        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        button:hover::before {
            left: 100%;
        }
        
        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            color: white;
        }
        
        .filter-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .filter-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 16px;
            background: rgba(15, 23, 42, 0.6);
            border-radius: var(--radius);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            font-size: 14px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .filter-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 100%;
            background: linear-gradient(90deg, rgba(79, 70, 229, 0.1), rgba(124, 58, 237, 0.1));
            transition: width 0.3s ease;
        }
        
        .filter-option:hover {
            background: rgba(79, 70, 229, 0.1);
            border-color: var(--primary-light);
        }
        
        .filter-option:hover::before {
            width: 100%;
        }
        
        .filter-option.active {
            background: rgba(79, 70, 229, 0.2);
            border-color: var(--primary-light);
            color: var(--primary-light);
        }
        
        .results-panel {
            padding: 30px;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        .results-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.8) 0%, rgba(15, 23, 42, 0.4) 100%);
            z-index: -1;
        }
        
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .results-header h2 {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-light), var(--secondary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .status-indicator {
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }
        
        .status-indicator::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .status-idle {
            background: rgba(100, 116, 139, 0.2);
            color: var(--gray-light);
        }
        
        .status-scanning {
            background: rgba(79, 70, 229, 0.2);
            color: var(--primary-light);
        }
        
        .status-complete {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success-light);
        }
        
        .results-container {
            flex: 1;
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            overflow: hidden;
            background: rgba(15, 23, 42, 0.4);
            max-height: 450px;
            box-shadow: var(--shadow);
        }
        
        .results-table-container {
            overflow: auto;
            max-height: 450px;
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        
        .results-table th {
            background: rgba(15, 23, 42, 0.9);
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: #cbd5e1;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 10;
            letter-spacing: 0.5px;
        }
        
        .results-table td {
            padding: 16px;
            border-bottom: 1px solid rgba(51, 65, 85, 0.5);
        }
        
        .results-table tr {
            transition: all 0.2s ease;
        }
        
        .results-table tr:hover {
            background: rgba(79, 70, 229, 0.05);
        }
        
        .policy-badge {
            padding: 6px 12px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 12px;
            text-align: center;
            display: inline-block;
            box-shadow: var(--shadow);
        }
        
        .policy-none {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
        }
        
        .policy-quarantine {
            background: rgba(245, 158, 11, 0.2);
            color: #fcd34d;
        }
        
        .policy-reject {
            background: rgba(16, 185, 129, 0.2);
            color: #6ee7b7;
        }
        
        .qualifier-cell {
            font-weight: 600;
            border-radius: 50px;
            padding: 6px 12px;
            text-align: center;
            display: inline-block;
            min-width: 50px;
            box-shadow: var(--shadow);
        }
        
        .qualifier-plus {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
        }
        
        .qualifier-tilde {
            background: rgba(245, 158, 11, 0.2);
            color: #fcd34d;
        }
        
        .qualifier-minus {
            background: rgba(16, 185, 129, 0.2);
            color: #6ee7b7;
        }
        
        .qualifier-none {
            background: rgba(100, 116, 139, 0.2);
            color: #cbd5e1;
        }
        
        .qualifier-question {
            background: rgba(168, 85, 247, 0.2);
            color: #c084fc;
        }
        
        .badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 50px;
            font-size: 12px;
            font-weight: 600;
            box-shadow: var(--shadow);
        }
        
        .badge-danger {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
        }
        
        .badge-success {
            background: rgba(16, 185, 129, 0.2);
            color: #6ee7b7;
        }
        
        .badge-warning {
            background: rgba(245, 158, 11, 0.2);
            color: #fcd34d;
        }
        
        .badge-info {
            background: rgba(6, 182, 212, 0.2);
            color: #67e8f9;
        }
        
        .vulnerable-row {
            background: rgba(239, 68, 68, 0.08) !important;
            position: relative;
        }
        
        .vulnerable-row::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 4px;
            background: var(--danger);
        }
        
        .secure-row {
            background: rgba(16, 185, 129, 0.08) !important;
            position: relative;
        }
        
        .secure-row::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 4px;
            background: var(--success);
        }
        
        .progress-container {
            margin-top: 20px;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 50px;
            height: 10px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }
        
        .progress-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: progressShimmer 2s infinite;
        }
        
        @keyframes progressShimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .summary {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 16px;
            margin-top: 24px;
        }
        
        .summary-item {
            background: rgba(15, 23, 42, 0.6);
            border-radius: var(--radius-lg);
            padding: 20px;
            text-align: center;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .summary-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(79, 70, 229, 0.1), rgba(124, 58, 237, 0.1));
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .summary-item:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-light);
        }
        
        .summary-item:hover::before {
            opacity: 1;
        }
        
        .summary-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--primary-light), var(--secondary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
            z-index: 1;
        }
        
        .summary-label {
            font-size: 13px;
            color: var(--gray-light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            z-index: 1;
        }
        
        .pulse {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .notification {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 16px 24px;
            border-radius: var(--radius-lg);
            color: white;
            font-weight: 500;
            box-shadow: var(--shadow-lg);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
            max-width: 300px;
            border-left: 4px solid;
        }
        
        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .notification-success {
            background: rgba(16, 185, 129, 0.9);
            border-left-color: var(--success);
        }
        
        .notification-error {
            background: rgba(239, 68, 68, 0.9);
            border-left-color: var(--danger);
        }
        
        .notification-info {
            background: rgba(79, 70, 229, 0.9);
            border-left-color: var(--primary);
        }
        
        .domain-detail-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }
        
        .domain-detail-content {
            background: var(--card-bg);
            border-radius: var(--radius-xl);
            padding: 30px;
            width: 80%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            animation: modalFadeIn 0.3s ease-out;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .domain-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 16px;
        }
        
        .domain-detail-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-light);
        }
        
        .domain-detail-close {
            background: none;
            border: none;
            color: var(--gray-light);
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        
        .domain-detail-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--danger);
            transform: rotate(90deg);
        }
        
        .domain-detail-section {
            margin-bottom: 24px;
        }
        
        .domain-detail-section h3 {
            font-size: 18px;
            margin-bottom: 12px;
            color: var(--primary-light);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .domain-detail-value {
            background: rgba(15, 23, 42, 0.6);
            padding: 16px;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            word-break: break-all;
            font-family: 'Inter', monospace;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .domain-detail-recommendation {
            background: rgba(79, 70, 229, 0.1);
            border: 1px solid rgba(79, 70, 229, 0.3);
            padding: 16px;
            border-radius: var(--radius);
            margin-top: 12px;
        }
        
        .domain-detail-recommendation h4 {
            font-size: 16px;
            margin-bottom: 8px;
            color: var(--primary-light);
        }
        
        .domain-detail-recommendation p {
            font-size: 14px;
            margin: 0;
            color: #e2e8f0;
            line-height: 1.5;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(15, 23, 42, 0.5);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(79, 70, 229, 0.5);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(79, 70, 229, 0.7);
        }
        
        /* Responsive design */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .control-panel {
                border-right: none;
                border-bottom: 1px solid var(--border);
                max-height: none;
            }

            .summary {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .filter-options {
                grid-template-columns: 1fr;
            }
            
            .summary {
                grid-template-columns: repeat(2, 1fr);
            }
            
            h1 {
                font-size: 32px;
            }
            
            .tagline {
                font-size: 16px;
            }
            
            .results-header h2 {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-shield-halved"></i> Email Security Scanner</h1>
            <p class="tagline">Analyze SPF and DMARC configurations simultaneously to identify email security vulnerabilities</p>
        </header>
        
        <div class="main-content">
            <div class="control-panel">
                <div class="panel-section">
                    <div class="section-title">
                        <i class="fas fa-upload"></i> Input
                    </div>
                    
                    <div class="file-upload-area" id="fileUploadArea">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <div class="file-upload-text">Upload domains file</div>
                        <div class="file-name" id="fileName" style="font-size: 12px; color: var(--gray-light); margin-top: 8px;">No file chosen</div>
                        <input type="file" id="fileInput" accept=".txt,.csv">
                    </div>
                    
                    <label style="display: block; font-weight: 500; margin-bottom: 10px; font-size: 14px; color: #cbd5e1;">Or enter domains:</label>
                    <textarea id="domainsInput" class="domains-input" placeholder="example.com&#10;example.org&#10;example.net"></textarea>
                </div>
                
                <div class="panel-section">
                    <div class="section-title">
                        <i class="fas fa-sliders-h"></i> Settings
                    </div>
                    
                    <div class="settings-grid">
                        <div class="setting-group">
                            <label>Workers</label>
                            <input type="number" id="workerCount" min="1" max="100" value="50">
                        </div>
                        <div class="setting-group">
                            <label>Delay (ms)</label>
                            <input type="number" id="delayMs" min="0" max="1000" value="10">
                        </div>
                    </div>
                    
                    <div class="buttons">
                        <button id="startBtn" class="btn-primary">
                            <i class="fas fa-play"></i> Start Scan
                        </button>
                        <button id="stopBtn" class="btn-danger" disabled>
                            <i class="fas fa-stop"></i> Stop Scan
                        </button>
                        <button id="exportCsvBtn" class="btn-success">
                            <i class="fas fa-download"></i> Export CSV
                        </button>
                    </div>
                </div>
                
                <div class="panel-section">
                    <div class="section-title">
                        <i class="fas fa-filter"></i> Filter
                    </div>
                    
                    <div class="filter-options">
                        <label class="filter-option active">
                            <input type="checkbox" id="filterAll" checked>
                            All
                        </label>
                        <label class="filter-option active">
                            <input type="checkbox" id="filterVulnerable" checked>
                            Vulnerable
                        </label>
                        <label class="filter-option active">
                            <input type="checkbox" id="filterSecure" checked>
                            Secure
                        </label>
                        <label class="filter-option active">
                            <input type="checkbox" id="filterNoSPF" checked>
                            No SPF
                        </label>
                        <label class="filter-option active">
                            <input type="checkbox" id="filterNoDMARC" checked>
                            No DMARC
                        </label>
                        <label class="filter-option active">
                            <input type="checkbox" id="filterPlusAll" checked>
                            +all
                        </label>
                        <label class="filter-option active">
                            <input type="checkbox" id="filterTildeAll" checked>
                            ~all
                        </label>
                        <label class="filter-option active">
                            <input type="checkbox" id="filterMinusAll" checked>
                            -all
                        </label>
                        <label class="filter-option active">
                            <input type="checkbox" id="filterQuestionAll" checked>
                            ?all
                        </label>
                        <label class="filter-option active">
                            <input type="checkbox" id="filterNoAll" checked>
                            No all
                        </label>
                    </div>
                </div>
            </div>
            
            <div class="results-panel">
                <div class="results-header">
                    <h2>Email Security Scan Results</h2>
                    <div class="status-indicator status-idle" id="statusIndicator">
                        <i class="fas fa-circle"></i> Idle
                    </div>
                </div>
                
                <div class="results-container">
                    <div class="results-table-container">
                        <table class="results-table">
                            <thead>
                                <tr>
                                    <th>Domain</th>
                                    <th>Qualifier</th>
                                    <th>SPF Record</th>
                                    <th>DMARC Record</th>
                                    <th>SPF Status</th>
                                    <th>DMARC Status</th>
                                    <th>Overall Status</th>
                                </tr>
                            </thead>
                            <tbody id="resultsBody">
                                <tr>
                                    <td colspan="7" style="text-align: center; padding: 40px; color: var(--gray-light);">
                                        <i class="fas fa-search" style="font-size: 40px; margin-bottom: 16px; opacity: 0.5;"></i>
                                        <div>No results yet. Start a scan to see results here.</div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="progress-container">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
                
                <div class="summary">
                    <div class="summary-item">
                        <div class="summary-value" id="totalDomains">0</div>
                        <div class="summary-label">Total</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value" id="vulnerableDomains">0</div>
                        <div class="summary-label">Vulnerable</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value" id="secureDomains">0</div>
                        <div class="summary-label">Secure</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value" id="noSpfDomains">0</div>
                        <div class="summary-label">No SPF</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value" id="noDmarcDomains">0</div>
                        <div class="summary-label">No DMARC</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Domain Detail Modal -->
    <div class="domain-detail-modal" id="domainDetailModal">
        <div class="domain-detail-content">
            <div class="domain-detail-header">
                <div class="domain-detail-title" id="domainDetailTitle">Domain Details</div>
                <button class="domain-detail-close" id="domainDetailClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="domain-detail-section">
                <h3><i class="fas fa-shield-alt"></i> SPF Record</h3>
                <div class="domain-detail-value" id="domainDetailSpf"></div>
                <div class="domain-detail-recommendation" id="spfRecommendation">
                    <h4>Recommendation</h4>
                    <p id="spfRecommendationText"></p>
                </div>
            </div>
            
            <div class="domain-detail-section">
                <h3><i class="fas fa-certificate"></i> DMARC Record</h3>
                <div class="domain-detail-value" id="domainDetailDmarc"></div>
                <div class="domain-detail-recommendation" id="dmarcRecommendation">
                    <h4>Recommendation</h4>
                    <p id="dmarcRecommendationText"></p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.getElementById('fileInput');
            const fileUploadArea = document.getElementById('fileUploadArea');
            const fileName = document.getElementById('fileName');
            const domainsInput = document.getElementById('domainsInput');
            const workerCount = document.getElementById('workerCount');
            const delayMs = document.getElementById('delayMs');
            const startBtn = document.getElementById('startBtn');
            const stopBtn = document.getElementById('stopBtn');
            const exportCsvBtn = document.getElementById('exportCsvBtn');
            const statusIndicator = document.getElementById('statusIndicator');
            const progressBar = document.getElementById('progressBar');
            const resultsBody = document.getElementById('resultsBody');
            
            // Filter elements
            const filterAll = document.getElementById('filterAll');
            const filterVulnerable = document.getElementById('filterVulnerable');
            const filterSecure = document.getElementById('filterSecure');
            const filterNoSPF = document.getElementById('filterNoSPF');
            const filterNoDMARC = document.getElementById('filterNoDMARC');
            const filterPlusAll = document.getElementById('filterPlusAll');
            const filterTildeAll = document.getElementById('filterTildeAll');
            const filterMinusAll = document.getElementById('filterMinusAll');
            const filterQuestionAll = document.getElementById('filterQuestionAll');
            const filterNoAll = document.getElementById('filterNoAll');
            
            const totalDomainsEl = document.getElementById('totalDomains');
            const vulnerableDomainsEl = document.getElementById('vulnerableDomains');
            const secureDomainsEl = document.getElementById('secureDomains');
            const noSpfDomainsEl = document.getElementById('noSpfDomains');
            const noDmarcDomainsEl = document.getElementById('noDmarcDomains');
            
            // Domain detail modal elements
            const domainDetailModal = document.getElementById('domainDetailModal');
            const domainDetailClose = document.getElementById('domainDetailClose');
            const domainDetailTitle = document.getElementById('domainDetailTitle');
            const domainDetailSpf = document.getElementById('domainDetailSpf');
            const domainDetailDmarc = document.getElementById('domainDetailDmarc');
            const spfRecommendationText = document.getElementById('spfRecommendationText');
            const dmarcRecommendationText = document.getElementById('dmarcRecommendationText');
            
            // Notification element
            const notification = document.getElementById('notification');
            
            let results = [];
            let filteredResults = [];
            let isScanning = false;
            let scanAborted = false;
            
            fileInput.addEventListener('change', handleFileSelect);
            fileUploadArea.addEventListener('click', () => fileInput.click());
            startBtn.addEventListener('click', startScan);
            stopBtn.addEventListener('click', stopScan);
            exportCsvBtn.addEventListener('click', exportToCSV);
            domainDetailClose.addEventListener('click', closeDomainDetailModal);
            
            // Close modal when clicking outside of it
            window.addEventListener('click', function(event) {
                if (event.target === domainDetailModal) {
                    closeDomainDetailModal();
                }
            });
            
            const filterOptions = document.querySelectorAll('.filter-option input');
            filterOptions.forEach(option => {
                option.addEventListener('change', applyFilter);
            });
            
            function handleFileSelect(event) {
                const file = event.target.files[0];
                if (file) {
                    fileName.textContent = file.name;
                    readFile(file).then(text => {
                        if (text) domainsInput.value = text;
                    });
                } else {
                    fileName.textContent = 'No file chosen';
                }
            }
            
            async function startScan() {
                const domainsText = domainsInput.value.trim();
                if (!domainsText) {
                    showNotification('Please enter domains or upload a file', 'error');
                    return;
                }
                
                const domains = extractDomains(domainsText);
                const uniqueDomains = [...new Set(domains)];
                
                if (uniqueDomains.length === 0) {
                    showNotification('No valid domains found', 'error');
                    return;
                }
                
                results = [];
                filteredResults = [];
                resultsBody.innerHTML = '';
                updateSummary();
                setScanningState(true);
                scanAborted = false;
                
                showNotification(`Starting scan of ${uniqueDomains.length} domains`, 'info');
                
                scanDomains(uniqueDomains, parseInt(workerCount.value), parseInt(delayMs.value));
            }
            
            function extractDomains(text) {
                const domainRegex = /([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}/g;
                const domains = text.match(domainRegex) || [];
                return domains.map(domain => domain.split('/')[0]);
            }
            
            function readFile(file) {
                return new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onload = (e) => resolve(e.target.result);
                    reader.onerror = () => resolve(null);
                    reader.readAsText(file);
                });
            }
            
            async function scanDomains(domains, maxWorkers, delay) {
                const total = domains.length;
                let completed = 0;
                let index = 0;
                const workers = [];
                
                progressBar.style.width = '0%';
                statusIndicator.className = 'status-indicator status-scanning';
                statusIndicator.innerHTML = '<i class="fas fa-sync-alt pulse"></i> Scanning';
                
                async function worker() {
                    while (index < total && !scanAborted) {
                        const currentIndex = index++;
                        const domain = domains[currentIndex];
                        
                        if (delay > 0) {
                            await new Promise(resolve => setTimeout(resolve, delay));
                        }
                        
                        try {
                            const result = await processDomain(domain);
                            results.push(result);
                            filteredResults.push(result);
                            renderResult(result);
                            updateSummary();
                            
                            completed++;
                            const progress = (completed / total) * 100;
                            progressBar.style.width = `${progress}%`;
                            
                            if (completed === total) {
                                finishScan();
                            }
                        } catch (error) {
                            console.error(`Error processing ${domain}:`, error);
                            completed++;
                        }
                    }
                }
                
                for (let i = 0; i < maxWorkers; i++) {
                    workers.push(worker());
                }
                
                await Promise.all(workers);
                
                if (scanAborted) {
                    statusIndicator.className = 'status-indicator status-idle';
                    statusIndicator.innerHTML = '<i class="fas fa-stop-circle"></i> Stopped';
                    showNotification('Scan stopped by user', 'info');
                }
            }
            
            async function processDomain(domain) {
                try {
                    // Process SPF record
                    const spfResponse = await fetch(`https://cloudflare-dns.com/dns-query?name=${domain}&type=TXT`, {
                        headers: { 'Accept': 'application/dns-json' }
                    });
                    
                    const spfData = await spfResponse.json();
                    
                    const spfRecords = spfData.Answer 
                        ? spfData.Answer.filter(record => record.data.includes('v=spf1'))
                        : [];
                    
                    let spfRecord = spfRecords.length > 0 ? spfRecords[0].data.replace(/"/g, '') : 'No SPF record found';
                    let spfQualifier = 'none';
                    let spfVulnerable = false;
                    let spfStatus = 'No SPF';
                    
                    if (spfRecords.length > 0) {
                        const allMatch = spfRecord.match(/([+~?-]?)(all)/);
                        if (allMatch) {
                            spfQualifier = allMatch[1] || '+';
                            
                            // Determine SPF vulnerability
                            spfVulnerable = spfQualifier === '+' || spfQualifier === '~' || spfQualifier === '?' || spfQualifier === 'none';
                            
                            if (spfQualifier === '+') {
                                spfStatus = 'Vulnerable';
                            } else if (spfQualifier === '~') {
                                spfStatus = 'Soft Fail';
                            } else if (spfQualifier === '-') {
                                spfStatus = 'Secure';
                            } else if (spfQualifier === '?') {
                                spfStatus = 'Neutral';
                            } else {
                                spfStatus = 'No all';
                            }
                        }
                    } else {
                        spfVulnerable = true;
                    }
                    
                    // Process DMARC record
                    const dmarcDomain = `_dmarc.${domain}`;
                    const dmarcResponse = await fetch(`https://cloudflare-dns.com/dns-query?name=${dmarcDomain}&type=TXT`, {
                        headers: { 'Accept': 'application/dns-json' }
                    });
                    
                    const dmarcData = await dmarcResponse.json();
                    
                    const dmarcRecords = dmarcData.Answer 
                        ? dmarcData.Answer.filter(record => record.data.includes('v=DMARC1'))
                        : [];
                    
                    let dmarcRecord = dmarcRecords.length > 0 ? dmarcRecords[0].data.replace(/"/g, '') : 'No DMARC record found';
                    let dmarcPolicy = 'none';
                    let dmarcPercentage = 100;
                    let dmarcVulnerable = false;
                    let dmarcStatus = 'No DMARC';
                    
                    if (dmarcRecords.length > 0) {
                        const record = dmarcRecords[0].data.replace(/"/g, '');
                        const policyMatch = record.match(/p=([^;]+)/);
                        const pctMatch = record.match(/pct=(\d+)/);
                        
                        dmarcPolicy = policyMatch ? policyMatch[1].trim() : 'none';
                        dmarcPercentage = pctMatch ? parseInt(pctMatch[1]) : 100;
                        
                        // Determine DMARC vulnerability
                        dmarcVulnerable = dmarcPolicy === 'none' || dmarcPercentage < 100;
                        
                        if (dmarcPolicy === 'none') {
                            dmarcStatus = 'Vulnerable';
                        } else if (dmarcPolicy === 'quarantine') {
                            dmarcStatus = dmarcPercentage === 100 ? 'Protected' : 'Partial';
                        } else if (dmarcPolicy === 'reject') {
                            dmarcStatus = dmarcPercentage === 100 ? 'Secure' : 'Partial';
                        }
                    } else {
                        dmarcVulnerable = true;
                    }
                    
                    // Determine overall vulnerability
                    const overallVulnerable = spfVulnerable || dmarcVulnerable;
                    
                    return {
                        domain,
                        spfRecord,
                        spfQualifier,
                        spfVulnerable,
                        spfStatus,
                        dmarcRecord,
                        dmarcPolicy,
                        dmarcPercentage,
                        dmarcVulnerable,
                        dmarcStatus,
                        overallVulnerable,
                        rawSpfTxt: spfData.Answer ? spfData.Answer.map(r => r.data).join('; ') : 'No TXT records',
                        rawDmarcTxt: dmarcData.Answer ? dmarcData.Answer.map(r => r.data).join('; ') : 'No TXT records'
                    };
                } catch (error) {
                    console.error(`Error processing ${domain}:`, error);
                    return {
                        domain,
                        spfRecord: 'Error querying DNS',
                        spfQualifier: 'error',
                        spfVulnerable: true,
                        spfStatus: 'Error',
                        dmarcRecord: 'Error querying DNS',
                        dmarcPolicy: 'error',
                        dmarcPercentage: 0,
                        dmarcVulnerable: true,
                        dmarcStatus: 'Error',
                        overallVulnerable: true,
                        rawSpfTxt: `Error: ${error.message}`,
                        rawDmarcTxt: `Error: ${error.message}`
                    };
                }
            }
            
            function renderResult(result) {
                if (resultsBody.firstChild && resultsBody.firstChild.colSpan) {
                    resultsBody.innerHTML = '';
                }
                
                const row = document.createElement('tr');
                
                if (result.overallVulnerable) {
                    row.classList.add('vulnerable-row');
                } else {
                    row.classList.add('secure-row');
                }
                
                // SPF qualifier class
                let spfQualifierClass = '';
                let qualifierText = '';
                
                if (result.spfQualifier === '+') {
                    spfQualifierClass = 'qualifier-plus';
                    qualifierText = '+all';
                } else if (result.spfQualifier === '~') {
                    spfQualifierClass = 'qualifier-tilde';
                    qualifierText = '~all';
                } else if (result.spfQualifier === '-') {
                    spfQualifierClass = 'qualifier-minus';
                    qualifierText = '-all';
                } else if (result.spfQualifier === '?') {
                    spfQualifierClass = 'qualifier-question';
                    qualifierText = '?all';
                } else {
                    spfQualifierClass = 'qualifier-none';
                    qualifierText = 'No all';
                }
                
                // DMARC policy class
                let dmarcPolicyClass = '';
                if (result.dmarcPolicy === 'none' || result.dmarcRecord.includes('No DMARC')) {
                    dmarcPolicyClass = 'policy-none';
                } else if (result.dmarcPolicy === 'quarantine') {
                    dmarcPolicyClass = 'policy-quarantine';
                } else if (result.dmarcPolicy === 'reject') {
                    dmarcPolicyClass = 'policy-reject';
                }
                
                // Status badges
                let spfStatusBadge = '';
                if (result.spfStatus === 'Vulnerable' || result.spfStatus === 'No SPF') {
                    spfStatusBadge = '<span class="badge badge-danger">' + result.spfStatus + '</span>';
                } else if (result.spfStatus === 'Soft Fail' || result.spfStatus === 'Neutral' || result.spfStatus === 'No all') {
                    spfStatusBadge = '<span class="badge badge-warning">' + result.spfStatus + '</span>';
                } else {
                    spfStatusBadge = '<span class="badge badge-success">' + result.spfStatus + '</span>';
                }
                
                let dmarcStatusBadge = '';
                if (result.dmarcStatus === 'Vulnerable' || result.dmarcStatus === 'No DMARC') {
                    dmarcStatusBadge = '<span class="badge badge-danger">' + result.dmarcStatus + '</span>';
                } else if (result.dmarcStatus === 'Partial') {
                    dmarcStatusBadge = '<span class="badge badge-warning">' + result.dmarcStatus + '</span>';
                } else {
                    dmarcStatusBadge = '<span class="badge badge-success">' + result.dmarcStatus + '</span>';
                }
                
                let overallStatusBadge = '';
                if (result.overallVulnerable) {
                    overallStatusBadge = '<span class="badge badge-danger">Vulnerable</span>';
                } else {
                    overallStatusBadge = '<span class="badge badge-success">Secure</span>';
                }
                
                row.innerHTML = `
                    <td style="cursor: pointer; font-weight: 600;" onclick="showDomainDetail('${result.domain}')">${result.domain}</td>
                    <td><span class="qualifier-cell ${spfQualifierClass}">${qualifierText}</span></td>
                    <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${result.spfRecord}">
                        ${result.spfRecord}
                    </td>
                    <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${result.dmarcRecord}">
                        ${result.dmarcRecord}
                    </td>
                    <td>${spfStatusBadge}</td>
                    <td>${dmarcStatusBadge}</td>
                    <td>${overallStatusBadge}</td>
                `;
                
                resultsBody.appendChild(row);
            }
            
            function showDomainDetail(domain) {
                const result = results.find(r => r.domain === domain);
                if (!result) return;
                
                domainDetailTitle.textContent = `Security Details for ${domain}`;
                domainDetailSpf.textContent = result.spfRecord;
                domainDetailDmarc.textContent = result.dmarcRecord;
                
                // Generate SPF recommendation
                let spfRecommendation = '';
                if (result.spfStatus === 'No SPF') {
                    spfRecommendation = 'Implement an SPF record to specify which servers are allowed to send email from your domain. Start with "v=spf1 -all" and gradually add authorized mail servers.';
                } else if (result.spfStatus === 'Vulnerable') {
                    spfRecommendation = 'Your SPF record uses "+all" which allows any server to send email from your domain. This makes your domain vulnerable to email spoofing. Change "+all" to "-all" or "~all" to restrict who can send email from your domain.';
                } else if (result.spfStatus === 'Soft Fail') {
                    spfRecommendation = 'Your SPF record uses "~all" which marks unauthorized emails as soft fail. Consider changing to "-all" to reject unauthorized emails outright.';
                } else if (result.spfStatus === 'Neutral') {
                    spfRecommendation = 'Your SPF record uses "?all" which doesn\'t provide any policy for unauthorized emails. Change to "-all" or "~all" to provide better protection.';
                } else if (result.spfStatus === 'No all') {
                    spfRecommendation = 'Your SPF record doesn\'t specify an "all" mechanism. Add "-all" at the end of your SPF record to reject unauthorized emails.';
                } else {
                    spfRecommendation = 'Your SPF record is properly configured with a strict policy. Regularly review and update it to ensure all authorized mail servers are included.';
                }
                
                spfRecommendationText.textContent = spfRecommendation;
                
                // Generate DMARC recommendation
                let dmarcRecommendation = '';
                if (result.dmarcStatus === 'No DMARC') {
                    dmarcRecommendation = 'Implement a DMARC record to provide email authentication policy. Start with "v=DMARC1; p=none; rua=mailto:dmarc@yourdomain.com" to collect reports, then gradually move to "quarantine" and "reject" policies.';
                } else if (result.dmarcStatus === 'Vulnerable') {
                    dmarcRecommendation = 'Your DMARC policy is set to "none" which means no action is taken on emails that fail authentication. Change to "quarantine" or "reject" to provide better protection.';
                } else if (result.dmarcStatus === 'Partial') {
                    dmarcRecommendation = 'Your DMARC policy is not applied to 100% of emails. Increase the percentage gradually until you reach 100% for full protection.';
                } else {
                    dmarcRecommendation = 'Your DMARC record is properly configured. Regularly review your DMARC reports to monitor email authentication and adjust your policy as needed.';
                }
                
                dmarcRecommendationText.textContent = dmarcRecommendation;
                
                // Show the modal
                domainDetailModal.style.display = 'flex';
            }
            
            function closeDomainDetailModal() {
                domainDetailModal.style.display = 'none';
            }
            
            function applyFilter() {
                const showAll = filterAll.checked;
                const showVulnerable = filterVulnerable.checked;
                const showSecure = filterSecure.checked;
                const showNoSPF = filterNoSPF.checked;
                const showNoDMARC = filterNoDMARC.checked;
                const showPlusAll = filterPlusAll.checked;
                const showTildeAll = filterTildeAll.checked;
                const showMinusAll = filterMinusAll.checked;
                const showQuestionAll = filterQuestionAll.checked;
                const showNoAll = filterNoAll.checked;
                
                // Update filter option styles
                document.querySelectorAll('.filter-option').forEach(option => {
                    const checkbox = option.querySelector('input');
                    if (checkbox.checked) {
                        option.classList.add('active');
                    } else {
                        option.classList.remove('active');
                    }
                });
                
                filteredResults = [];
                resultsBody.innerHTML = '';
                
                if (results.length === 0) {
                    resultsBody.innerHTML = `
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 40px; color: var(--gray-light);">
                                <i class="fas fa-search" style="font-size: 40px; margin-bottom: 16px; opacity: 0.5;"></i>
                                <div>No results yet. Start a scan to see results here.</div>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                // Filter results based on selections
                results.forEach(result => {
                    let shouldShow = false;
                    
                    if (showAll) {
                        shouldShow = true;
                    } else {
                        // Check status filters
                        if (showVulnerable && result.overallVulnerable) shouldShow = true;
                        if (showSecure && !result.overallVulnerable) shouldShow = true;
                        if (showNoSPF && result.spfRecord.includes('No SPF')) shouldShow = true;
                        if (showNoDMARC && result.dmarcRecord.includes('No DMARC')) shouldShow = true;
                        
                        // Check SPF qualifier filters
                        if (showPlusAll && result.spfQualifier === '+') shouldShow = true;
                        if (showTildeAll && result.spfQualifier === '~') shouldShow = true;
                        if (showMinusAll && result.spfQualifier === '-') shouldShow = true;
                        if (showQuestionAll && result.spfQualifier === '?') shouldShow = true;
                        if (showNoAll && result.spfQualifier === 'none') shouldShow = true;
                    }
                    
                    if (shouldShow) {
                        filteredResults.push(result);
                        renderResult(result);
                    }
                });
                
                if (filteredResults.length === 0) {
                    resultsBody.innerHTML = `
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 40px; color: var(--gray-light);">
                                <i class="fas fa-filter" style="font-size: 40px; margin-bottom: 16px; opacity: 0.5;"></i>
                                <div>No results match the selected filters.</div>
                            </td>
                        </tr>
                    `;
                }
                
                updateSummary();
            }
            
            function updateSummary() {
                const total = results.length;
                const vulnerable = results.filter(r => r.overallVulnerable).length;
                const secure = total - vulnerable;
                const noSpf = results.filter(r => r.spfRecord.includes('No SPF')).length;
                const noDmarc = results.filter(r => r.dmarcRecord.includes('No DMARC')).length;
                
                totalDomainsEl.textContent = total;
                vulnerableDomainsEl.textContent = vulnerable;
                secureDomainsEl.textContent = secure;
                noSpfDomainsEl.textContent = noSpf;
                noDmarcDomainsEl.textContent = noDmarc;
            }
            
            function setScanningState(scanning) {
                isScanning = scanning;
                startBtn.disabled = scanning;
                stopBtn.disabled = !scanning;
                
                if (!scanning && !scanAborted) {
                    statusIndicator.className = 'status-indicator status-complete';
                    statusIndicator.innerHTML = '<i class="fas fa-check-circle"></i> Complete';
                    showNotification('Scan completed successfully', 'success');
                }
            }
            
            function finishScan() {
                setScanningState(false);
                scanAborted = false;
                applyFilter(); // Apply initial filter after scan completes
            }
            
            function stopScan() {
                scanAborted = true;
                setScanningState(false);
            }
            
            function exportToCSV() {
                if (results.length === 0) {
                    showNotification('No data to export', 'error');
                    return;
                }
                
                const headers = ['Domain', 'Qualifier', 'SPF Record', 'DMARC Record', 'SPF Status', 'DMARC Status', 'Overall Status'];
                const csvContent = [
                    headers.join(','),
                    ...results.map(row => [
                        row.domain,
                        row.spfQualifier === '+' ? '+all' : 
                        row.spfQualifier === '~' ? '~all' : 
                        row.spfQualifier === '-' ? '-all' : 
                        row.spfQualifier === '?' ? '?all' : 'No all',
                        `"${row.spfRecord.replace(/"/g, '""')}"`,
                        `"${row.dmarcRecord.replace(/"/g, '""')}"`,
                        row.spfStatus,
                        row.dmarcStatus,
                        row.overallVulnerable ? 'Vulnerable' : 'Secure'
                    ].join(','))
                ].join('\n');
                
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', 'email_security_scan_results.csv');
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showNotification('Results exported successfully', 'success');
            }
            
            function showNotification(message, type = 'info') {
                notification.textContent = message;
                notification.className = 'notification';
                
                if (type === 'success') {
                    notification.classList.add('notification-success');
                } else if (type === 'error') {
                    notification.classList.add('notification-error');
                } else {
                    notification.classList.add('notification-info');
                }
                
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
        });
    </script>
</body>
</html>
